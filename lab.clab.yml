name: network-demo

mgmt: # 管理用ネットワーク
  network: custom_mgm
  ipv4-subnet: 172.99.0.0/24

# Network A (192.168.1.0/24): srvA1 と rtA が所属
# Link rtA--rt-asbr (10.0.0.0/30): 内部リンク
# Link rt-asbr--rtB (10.0.0.4/30): 内部リンク
# BGP Link rt-asbr--rt-external (192.0.2.0/30): AS境界リンク (TEST-NET-1)
# Network B (192.168.2.0/24): srvB1 と rtB が所属
# External Network (203.0.113.0/24): srvExt と rt-external が所属

topology:
  nodes:
    rtA:
      # eth1: 10.0.0.1/30
      # eth2: 192.168.1.1/24
      kind: linux
      image: frrouting/frr:latest
      binds:
      - rtA.conf:/etc/frr/frr.conf
      - daemons:/etc/frr/daemons
    srvA1:
      kind: linux
      image: alpine:latest
      exec:
        - ip addr add 192.168.1.10/24 dev eth1
        - ip route replace 0.0.0.0/0 via 192.168.1.1
    rt-asbr:
      # eth1: 10.0.0.2/30 (rtA 側)
      # eth2: 10.0.0.5/30 (rtB 側)
      # eth3: 192.0.2.1/30 (rt-external 側, BGP)
      kind: linux
      image: frrouting/frr:latest
      binds:
      - rt-asbr.conf:/etc/frr/frr.conf
      - daemons:/etc/frr/daemons
    rtB:
      # eth1: 10.0.0.6/30
      # eth2: 192.168.2.1/24
      kind: linux
      image: frrouting/frr:latest
      binds:
      - rtB.conf:/etc/frr/frr.conf
      - daemons:/etc/frr/daemons
    srvB1:
      kind: linux
      image: alpine:latest
      exec:
        - ip addr add 192.168.2.10/24 dev eth1
        - ip route replace 0.0.0.0/0 via 192.168.2.1
    rt-external:
      # eth1: 192.0.2.2/30 (rt-asbr 側, BGP)
      # eth2: 203.0.113.1/24
      kind: linux
      image: frrouting/frr:latest
      binds:
      - rt-external.conf:/etc/frr/frr.conf
      - daemons:/etc/frr/daemons
    srvExt:
      kind: linux
      image: alpine:latest
      exec:
        - ip addr add 203.0.113.10/24 dev eth1
        - ip route replace 0.0.0.0/0 via 203.0.113.1

  links:
  - endpoints: ["rtA:eth1", "rt-asbr:eth1"]
  - endpoints: ["rt-asbr:eth2", "rtB:eth1"]
  - endpoints: ["rt-asbr:eth3", "rt-external:eth1"]
  - endpoints: ["rtA:eth2", "srvA1:eth1"]
  - endpoints: ["rtB:eth2", "srvB1:eth1"]
  - endpoints: ["rt-external:eth2", "srvExt:eth1"]
